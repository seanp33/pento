<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Jun 18, 2013 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Shadowman - </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
        <style>body{padding-top: 20px;}</style>
    
      
    <script type="text/javascript" src="./js/apache-maven-fluido.min.js"></script>

    
    <meta name="Date-Revision-yyyymmdd" content="20130618" />
    <meta http-equiv="Content-Language" content="en" />
    
        </head>
  <body>
      
        
    
        <div class="container-fluid">
                <div id="banner">
        <div class="pull-left">                  <a href="https://bitbucket.org/smonaghan/shadowman/" id="bannerLeft">
                                                                                                <img src="images/shadowman_logo.png"  alt="Shadowman"/>
                </a>
      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>
      
      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2013-06-18</li>
                      
                
                    
                 <li id="projectVersion" class="pull-right">Version: 1.0.0-SNAPSHOT</li>
      
                  </ul>
      </div>

            <div id="leftColumn" class="sidebar">
        <div class="well">
                
                    
                                   <h5>Topics</h5>
                  <ul>
                  <li class="none">
                          <a href="overview.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="goals.html" title="Goals">Goals</a>
            </li>
                  <li class="none">
                          <a href="getting_started.html" title="Getting Started">Getting Started</a>
            </li>
                  <li class="none">
            <strong>Concepts</strong>
          </li>
                  <li class="none">
                          <a href="agent_configuration.html" title="Agent Configuration">Agent Configuration</a>
            </li>
                  <li class="none">
                          <a href="ec2_deployment.html" title="Automated Deployment to Amazon EC2">Automated Deployment to Amazon EC2</a>
            </li>
                  <li class="none">
                          <a href="simulation_definitions.html" title="Simulation Definitions">Simulation Definitions</a>
            </li>
                  <li class="none">
                          <a href="evaluation_guidelines.html" title="Evaluation Guidelines">Evaluation Guidelines</a>
            </li>
                  <li class="none">
                          <a href="roadmap.html" title="Road Map">Road Map</a>
            </li>
                  <li class="none">
                          <a href="transition_plan.html" title="Transition Plan">Transition Plan</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                        <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                      <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                       <h5>Modules</h5>
                  <ul>
                  <li class="none">
                          <a href="shadowman-store/index.html" title="shadowman-store">shadowman-store</a>
            </li>
                  <li class="none">
                          <a href="shadowman-core/index.html" title="shadowman-core">shadowman-core</a>
            </li>
                  <li class="none">
                          <a href="shadowman-simulation/index.html" title="shadowman-simulation">shadowman-simulation</a>
            </li>
                  <li class="none">
                          <a href="shadowman-local-dev-resources/index.html" title="shadowman-local-dev-resources">shadowman-local-dev-resources</a>
            </li>
                  <li class="none">
                          <a href="shadowman-agent/index.html" title="shadowman-agent">shadowman-agent</a>
            </li>
          </ul>
                      
                    
                
            
          <div id="poweredBy">
                            <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                </div>
        </div>
      </div>
      
      <div id="bodyColumn" class="content">
        <div id="contentBox">
                              
          <h1>Concepts</h1><div class="section"><h2>Key Abstractions<a name="Key_Abstractions"></a></h2><p>There are several key abstractions in the design of Shadowman</p><div class="section"><h3>Pento<a name="Pento"></a></h3><p>Shadowman utilizes the open source <a class="externalLink" href="https://github.com/seanp33/pento">Pento framework</a> for its flexible subject/predicate/object data model as well as its distributed, asynchronous storage abstractions. A <a class="externalLink" href="http://seanp33.github.io/pento/apidocs/pento/model/Pento.html">Pento</a> is a simple value object which maintains a collection of <a class="externalLink" href="http://seanp33.github.io/pento/apidocs/pento/model/Statement.html">Statements</a>. A statement is comprised of the following fields</p>
<ul>
  <li>Subject: The subject of the statement</li>
  <li>Predicate: The predicate, describing the object</li>
  <li>Object: The object value</li>
  <li>Local timestamp: The time the statement was asserted, locally. In Shadowman, this value does not account for any temporal  aspect of the distributed system. Shadowman does not use this value to determine causality of distributed fact operations. See Generation.</li>
  <li>Origin: Where the statement was asserted. In Shadowman, this is the URL of the agent.</li>
  <li>Generation: An ordered list of origin-to-version mappings which Shadowman utilizes as a <a class="externalLink" href="http://en.wikipedia.org/wiki/Vector_clock">vector clock</a> to ensure that fresh statements are not incorrectly mutated due to a clients belief that a stale statement is indeed current.</li>
  <li>Command: An enumeration of NONE, SAVED, ASSERT, DELETE or UPDATE which indicates the desired action to be taken against the statement during persistence.</li>
</ul><p>In addition to Pentos statement-based data model, there are several other Pento abstractions which Shadowman implements and utilizes to perform quorum formalization, query federation and distributed persistence.</p><div class="section"><h4>Pento Store<a name="Pento_Store"></a></h4><p>The <a class="externalLink" href="http://seanp33.github.io/pento/apidocs/pento/store/PentoStore.html">PentoStore</a> serves as the outermost interface to a distributed fact repository. It exposes, simple read, write, and close operations supporting asynchronous query and persistence of Penti. The read and write operations accept a <a class="externalLink" href="http://seanp33.github.io/pento/apidocs/pento/handler/PentoCallback.html">PentoCallback</a> where by the Pento Store will inform the callback of necessary success and error events, as well as an <a class="externalLink" href="http://seanp33.github.io/pento/apidocs/pento/store/OperationContext.html">OperationContext</a> which can provide any context specific values to the underlying store upon invocation.</p><p>Pento provides the <a class="externalLink" href="http://seanp33.github.io/pento/apidocs/pento/store/DefaultPentoStore.html">Default Pento Store</a>, which Shadowman utilizes. The Default Pento Store exposes a configurable strategy-based storage mechanism which allows it to support a diverse set of persistence and query requests.</p><div class="section"><h5>Store workers<a name="Store_workers"></a></h5><p>At query and persistence-time, the Default Pento Store delegates all operations to <a class="externalLink" href="http://seanp33.github.io/pento/apidocs/pento/store/worker/PentoStoreWorker.html">PentoStoreWorker</a> implementations. Specifically, Shadowman utilizes <a href="apidocs/shadowman/pento/BayeuxPublishingReader.html">BayeuxPublishingReader</a> and <a href="apidocs/shadowman/pento/BayeuxPublishingWriter.html">BayeuxPublishingWriter</a> to perform its read and write operations. It is within the workers that Shadowman carries its CometD-based distributed operations across the quorum. In this way, the Default Pento Store internally delegates all read and write tasks to its Pento Store Workers and acts as the executor of these tasks, handling the necessary thread allocation and callback invocations.</p></div></div><div class="section"><h4>Distribution<a name="Distribution"></a></h4><p>A <a class="externalLink" href="http://seanp33.github.io/pento/apidocs/pento/model/Distribution.html">Distribution</a> is a collection of uniquely identifiable locations within a distributed system. Shadowman implements Distribution as <a href="apidocs/shadowman/pento/distribution/BayeuxClientDistribution.html">BayeuxClientDistribution</a>. All storage operations in Pento accept a Distribution which informs the underlying Pento Store of how persistence and query operations should be distributed throughout the quorum. A Distribution also maintains the notion of <i>includesLocal</i> thereby informing the Pento Store of whether it should also include the local site in its persistence and query operations.</p>
<hr /></div></div><div class="section"><h3>Shadowman<a name="Shadowman"></a></h3><div class="section"><h4>Agent<a name="Agent"></a></h4><p>An agent is the deployable and executable artifact which comprises a single node in the distributed system. It serves four primary functions</p>
<ul>
  <li>Establish and maintain quorum with all agents within the Known Universe</li>
  <li>Query federation and distributed fact persistence
  <ul>
    <li>An agent exposes a collection of CometD services which performs query and persistence of <a href="#aPento">Pento</a> statements(penti).</li>
  </ul></li>
  <li><p>Bloom filter storage and distribution requests</p>
  <ul>
    <li>As facts are asserted each agent maintains a bloom filter-based probabilistic hash of all subjects, predicates, and  objects at rest in its store. Note that the current bloom implementation does not support deletes. It is recommended that  future development migrate to a <a class="externalLink" href="http://en.wikipedia.org/wiki/Bloom_filter#Counting_filters">counting bloom</a>  implementation to address this limitation. Future work should also consider a mechanism where by a bloom filter can be  rebuilt from the underlying database as part of a routine database operation. For this reason it should be known that  all delete operations will not properly inform the bloom filter that deleted facts are no longer at rest within the store,  resulting a higher rate of false positives throughout the quorum. Bloom filters are presently maintained within  <a href="apidocs/shadowman/filter/BloomFilterStatementDistribution.html">BloomFilterStatementDistribution</a>  and are subsequently considered at query-time, by way of the  <a href="apidocs/shadowman/pento/filter/StatementDistributionReaderFactory.html">StatementDistributionReaderFactory</a>.  When configured to use the StatementDistributionReaderFactory, the Default Pento Store will delegate all reads to  <a href="apidocs/shadowman/pento/filter/StatementDistributionReader.html">StatementDistributionReaders</a> which internally,  intelligently exclude agents from the distribution which are known to not have facts that would satisfy the  federated query.</li>
  </ul><p>Over the life of an agent its bloom filter could potentially change many times. Additional, the bloom filter  could grow to become quite large. Distributing these BloomFilterStatementDistribution across the quorum utilizes  a specialized mechanism which runs out-of-band from the rest of the agent-to-agent communication. For more details  about this process, see <a href="bloom_filter_lifecycle">Bloom filter lifecycle</a>.</p></li>
  <li><p>Simulation console provisioning At its core, each agent is a built upon an embedded Jetty server. In addition to acting as a container to the CometD, Oort and Shadowman servlets, this Jetty service hosts a collection of static javascipt, html and css resources that define the Simulation Console.</p></li>
</ul></div><div class="section"><h4>Known Universe<a name="Known_Universe"></a></h4><p>Shadowman allows each agent to specify, within its <a href="./agent_configuration.html">configuration</a>, its expected relationship with other agents in the form of a Known Universe singleton.</p>
<div class="source"><pre class="prettyprint">&lt;knownUniverse&gt;
        &lt;topology&gt;
            &lt;name&gt;default&lt;/name&gt;
            &lt;member&gt;
                &lt;name&gt;https://localhost:9000/shadowman/cometd&lt;/name&gt;
                &lt;confidence&gt;LOCAL&lt;/confidence&gt;
            &lt;/member&gt;
            &lt;member&gt;
                &lt;name&gt;https://localhost:9001/shadowman/cometd&lt;/name&gt;
                &lt;confidence&gt;GLOBAL&lt;/confidence&gt;
            &lt;/member&gt;
            &lt;member&gt;
                &lt;name&gt;https://localhost:9002/shadowman/cometd&lt;/name&gt;
                &lt;confidence&gt;GLOBAL&lt;/confidence&gt;
            &lt;/member&gt;
            &lt;member&gt;
                &lt;name&gt;https://localhost:9003/shadowman/cometd&lt;/name&gt;
                &lt;confidence&gt;GLOBAL&lt;/confidence&gt;
            &lt;/member&gt;
            &lt;member&gt;
                &lt;name&gt;https://localhost:9004/shadowman/cometd&lt;/name&gt;
                &lt;confidence&gt;GLOBAL&lt;/confidence&gt;
            &lt;/member&gt;
            &lt;member&gt;
                &lt;name&gt;https://localhost:9005/shadowman/cometd&lt;/name&gt;
                &lt;confidence&gt;GLOBAL&lt;/confidence&gt;
            &lt;/member&gt;
        &lt;/topology&gt;
        &lt;topology&gt;
             &lt;name&gt;first_responders&lt;/name&gt;
             &lt;member&gt;
                 &lt;name&gt;https://localhost:9001/shadowman/cometd&lt;/name&gt;
                 &lt;confidence&gt;GLOBAL&lt;/confidence&gt;
             &lt;/member&gt;
             &lt;member&gt;
                 &lt;name&gt;https://localhost:9002/shadowman/cometd&lt;/name&gt;
                 &lt;confidence&gt;GLOBAL&lt;/confidence&gt;
             &lt;/member&gt;
        &lt;/topology&gt;
        &lt;topology&gt;
            &lt;name&gt;acme_widget_storage&lt;/name&gt;
            &lt;member&gt;
                &lt;name&gt;https://localhost:9005/shadowman/cometd&lt;/name&gt;
                &lt;confidence&gt;GLOBAL&lt;/confidence&gt;
            &lt;/member&gt;
        &lt;/topology&gt;
    &lt;/knownUniverse&gt;
</pre></div><p>The <a href="apidocs/shadowman/topology/KnownUniverse.html">Known Universe</a> allows for named logical groupings of agents, in the form of a <a href="apidocs/shadowman/topology/Topology.html">Topology</a>. During quorum assembly, remote agents attempt to <a class="externalLink" href="http://docs.cometd.org/apidocs/org/cometd/client/BayeuxClient.html">handshake</a> with every member of their Known Universe. As an agent attempts to service a remote agents incoming handshake, it will consult its Known Universe, in order to locate a member whose, CometD URL matches that of the agent issuing the handshake. If it does not recognize the remote agent, the handshake is ignored resulting no CometD connection being established, and therefor no quorum assembly between the two agents.</p></div><div class="section"><h4>Distribution Registry<a name="Distribution_Registry"></a></h4><p>Upon successfully forming quorum, the accepting agent will consult its <a href="apidocs/shadowman/pento/distribution/BayeuxClientDistributionRegistry.html">BayeuxClientDistributionRegistry</a>, to determine if a <a href="apidocs/shadowman/bayeux/BayeuxClientProxy.html">BayeuxClientProxy</a> has already been provisioned for the remote agent. If not, one is created, or if so an existing BayeuxClientProxy is referenced. The BayeuxClientProxy is then registered by Topology name, once for each Topology its associated with, as defined within the KnownUniverse. From that point forward, the resulting BayeuxClientDistributionRegistry provides simple name-based resolution of logical groupings of BayeuxClientProxies. This key abstraction is subsequently consulted over the life of the agent, for obtaining named Distributions for all read and write operations.</p></div></div></div>
                  </div>
      </div>
    </div>

    <footer class="footer">
            <div class="container-fluid">
              <div class="row span16">Copyright &copy;                   2013.
          All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
